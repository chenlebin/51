C51 COMPILER V9.00   MAIN                                                                  06/25/2021 08:32:10 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: E:\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*----------------------------------------
   2          ¹¦ÄÜ: ÓÃHC-SR04³¬Éù²¨Ä£¿é²âÁ¿¾àÀë
   3          ²¢ÓÃµ¥Æ¬»ú(STC89C52RC)½ÓÊÕĞÅºÅ£¬¼ÆËã¾àÀë£¬
   4          ²¢ÔÚLCD1602ÉÏÊµÊ±ÏÔÊ¾µ±Ç°¾àÀë¡£
   5          ¾àÀë=£¨¸ßµçÆ½Ê±¼ä*ÉùËÙ£©/2£¬
   6          ¸ßµçÆ½Ê±¼ä¾ÍÊÇ³¬Éù²¨Íù·µµÄÊ±¼ä¡£
   7          ----------------------------------------*/
   8          #include <Ultrasonic.h>  //µ÷ÓÃÍ·ÎÄ¼şUltrasonic.h£º£¨ÆäÖĞ°üÀ¨Ò»Ğ©µ÷ÓÃÍ·ÎÄ¼ş£¬³õÊ¼»¯±äÁ¿£¬ºê¶¨ÒåºÍÒ»Ğ©º¯ÊıÉ
             -ùÃ÷£©
   9          #include <I2C.H>
  10          
  11          /*¶¨ÒåÈ«¾Ö±äÁ¿*/
  12          uint time = 0; // ¼ÇÂ¼»ØÉù¸ßµçÆ½³ÖĞøÊ±¼ä
  13          float distance = 0; // ´æ·Å¾àÀë
  14          unsigned  int jieshou;//´æ·Å´ÓPC¶Ë½ÓÊÕµ½µÄÊı¾İ
  15          unsigned  int flag=0;//·¢ËÍÄ£¿éµÄÈ·ÈÏĞÅÏ¢
  16          
  17          /*¶¨ÒåLCD1602ÏÔÊ¾Ä£¿éÏÔÊ¾µÄÄÚÈİ£¨ÓÃÊı×éĞÎÊ½´æÖü£©*/
  18          //LCD1602ÏÔÊ¾µÄµÚÒ»ĞĞĞÅÏ¢Ô¤Áô¸ø¹âÕÕÄ£¿é
  19          uchar code table0[] = {"GQ:"};            //±ê×¢ĞÅÏ¢£º¹âÇ¿
  20          uchar code table4[] = {"Lux"};            //µ¥Î»:LuxÀÕ¿ËË¹
  21          // ±äÁ¿¶¨Òå
  22          unsigned char AD_CHANNEL;
  23          unsigned long xdata  LedOut[4]={0,0,0,0};        //´æ·Å´¦Àí¹ıºóµÄ¹âÇ¿ĞÅÏ¢
  24          unsigned int  D[32];
  25          unsigned char date;
  26          unsigned int weixian=500;//Í¨¹ı´®¿ÚÉèÖÃÎ£ÏÕ¾àÀë£¬Ä¬ÈÏÖµÎª500
  27          
  28          
  29          
  30          //LCD1602ÏÔÊ¾µÄµÚ¶şĞĞĞÅÏ¢£¬ÏÔÊ¾³¬Éù²¨²â¾àÄ£¿é£º
  31          uchar code table1[] = {"Distance:"};  //±ê×¢ĞÅÏ¢
  32          uchar code table2[] = {"0123456789"}; //¾àÀë
  33          uchar code table3[] = {"mm"};             //µ¥Î»:mm
  34          // ±äÁ¿¶¨Òå
  35          uchar num = 0;
  36          uint nn=0;
  37          uchar dis[4];//´æ·Å´¦Àí¹ıºóµÄ¾àÀëĞÅÏ¢
  38          
  39          
  40          /*Ö÷º¯Êı*/
  41          void main(){
  42   1          
  43   1              LCDInit();//LCDÏÔÊ¾³õÊ¼»¯º¯Êı
  44   1              timerInit();//¶¨Ê±Æ÷0ºÍ1³õÊ¼»¯º¯Êı
  45   1              while(1){
  46   2                      int i=0;                
  47   2                   /*******ÒÔÏÂ³¬Éù²¨¾àÀë´¦Àí*********/               
  48   2                      uint disINT = (uint)distance;      //Ç¿ÖÆÀàĞÍ×ª»»£¬½«¸¡µãĞÍÊı¾İ£¨float£©dat×ª»»³ÉÎŞ·ûºÅÕûĞÍÊı¾İ£¨unsigned 
             -int£©
  49   2                      /*ÏÈ¹Ø±Õ·äÃùÆ÷*/
  50   2                  fm=1;
  51   2      
  52   2                      echo = 0; // ½ÓÊÕ»ØÒô¶ËÖÃ0
  53   2                      startUltra(); // Æô¶¯³¬Éù²â¾à
C51 COMPILER V9.00   MAIN                                                                  06/25/2021 08:32:10 PAGE 2   

  54   2                      while(!echo); // µÈ´ı»ØÒô
  55   2                      TR0 = 1; // ¿ªÊ¼¼ÆÊ±
  56   2                      while(echo);
  57   2                      TR0 = 0; // Í£Ö¹¼ÆÊ±
  58   2                      computeDis(); // ¼ÆËã¾àÀë
  59   2      
  60   2                      //¼ÆËã¾àÀëÖµ£¬È»ºó½«Öµ´«¸ø´®¿Ú²¢Í¨¹ıdisplay£¨£©ÏÔÊ¾µ½LCDÏÔÊ¾Æ÷ÉÏ                
  61   2              dis[0] = disINT / 1000;        //È¡³öÇ§Î»
  62   2              dis[1] = disINT % 1000 / 100;  //È¡³ö°ÙÎ»
  63   2                  dis[2] = disINT % 100 / 10;    //È¡³öÊ®Î»
  64   2                  dis[3] = disINT % 10;          //È¡³ö¸öÎ»
  65   2      
  66   2      
  67   2                  //µ¹³µ±¨¾¯Ä£¿é
  68   2                      //Çé¿ö1£º
  69   2                      //µ±³µÎ²¾àÀëÇ½±ÚĞ¡ÓÚ500mmÊ±·äÃùÆ÷ÃùµÑ±¨¾¯
  70   2                      if(disINT<=weixian)
  71   2                      {
  72   3                              fm=0;
  73   3                      }
  74   2                      //Çé¿ö2£º
  75   2                      //µ±³µÎ²¾àÀëÇ½±Ú´óÓÚ500mmÊ±Æû³µ´¦ÓÚ°²È«×´Ì¬£¬·äÃùÆ÷²»Ïì
  76   2                      else
  77   2                      {
  78   3                              fm=1;
  79   3                      }
  80   2                      
  81   2                      /********ÒÔÏÂ½«¾àÀëÖµÍ¨¹ı´®¿Ú·¢ËÍ³öÈ¥************/
  82   2      
  83   2                      
  84   2                      if(flag==1)        //·¢ËÍÊı¾İÌõ¼ş£¬¿ª¹ØÔÚ´®¿ÚÖĞ¶Ïº¯ÊıÖĞ£¬µ±½ÓÊÕÍêPC¶ËĞÅÏ¢ºó×Ô¶¯´¥·¢
  85   2           {
  86   3                      ES=0;  //¹Ø±Õ´®¿ÚÖĞ¶Ï£¬ÏÈ½«ĞèÒª·¢ËÍ¸øPC¶ËµÄµ¹³µ¾àÀëÊı¾İ£¬°´Î»·¢ËÍ¸øPC¶ËÖ±µ½È«²¿·¢ËÍÍê±Ï
  87   3               for(i=0;i<4;i++)
  88   3                       {
  89   4               SBUF=dis[i];//´æÒ»Ìõ·¢Ò»Ìõ£¬Ö±µ½·¢ÍêÎªÖ¹
  90   4               while(!TI);
  91   4               TI=0;              //Èí¼şÇå0£¬È»ºóÑ­»·ÏÂÒ»´Î×Ö·û
  92   4               }
  93   3      
  94   3                      //ES=1; //¿ªÆô´®¿ÚÖĞ¶ÏµÈ´ıÏÂÒ»´ÎµÄPC¶ËÊı¾İ·¢ËÍ£¨Ò²¾ÍÊÇµ¥Æ¬»úµÈ´ı½ÓÊÕ£©
  95   3                  //flag=0;
  96   3               }
  97   2      
  98   2      
  99   2                      delay(100);
 100   2                      /*·¢ËÍ¾àÀëºÍ¹âÕÕÇ¿¶ÈµÄÊ±¼äÃ¿¸ô100ms·¢Ò»´Î*/
 101   2                      /********ÒÔÏÂAD-DA´¦Àí*************/    
 102   2                   switch(AD_CHANNEL)
 103   2                       {
 104   3                               case 0: ISendByte(PCF8591,0x41);
 105   3                                    D[0]=IRcvByte(PCF8591);  //ADC0 Ä£Êı×ª»»1      ¹âÃôµç×è
 106   3                                        break;  
 107   3                              
 108   3                               case 1: ISendByte(PCF8591,0x42);
 109   3                                    D[1]=IRcvByte(PCF8591);  //ADC1  Ä£Êı×ª»»2          ÈÈÃôµç×è
 110   3                                        break;  
 111   3                              
 112   3                               case 2: ISendByte(PCF8591,0x43);
 113   3                                    D[2]=IRcvByte(PCF8591);  //ADC2   Ä£Êı×ª»»3          Ğü¿Õ
 114   3                                        break;  
 115   3                              
C51 COMPILER V9.00   MAIN                                                                  06/25/2021 08:32:10 PAGE 3   

 116   3                               case 3: ISendByte(PCF8591,0x40);
 117   3                                    D[3]=IRcvByte(PCF8591);  //ADC3   Ä£Êı×ª»»4          ¿Éµ÷0-5v
 118   3                                        break;  
 119   3                              
 120   3                               case 4: DACconversion(PCF8591,0x40, D[4]); //DAC         ÊıÄ£×ª»»
 121   3                                    break;
 122   3                       
 123   3                       }
 124   2      
 125   2             D[4]=D[3];  //°ÑÄ£ÄâÊäÈë²ÉÑùµÄĞÅºÅ Í¨¹ıÊıÄ£×ª»»Êä³ö
 126   2                              
 127   2                 if(++AD_CHANNEL>4) AD_CHANNEL=0;
 128   2              
 129   2                 //¼ÆËãADÖµ£¬È»ºó½«Öµ´«¸ø´®¿Ú²¢Í¨¹ıdisplay£¨£©ÏÔÊ¾µ½LCDÏÔÊ¾Æ÷ÉÏ£¬ÎÒÃÇÎªÁËÌá¸ßÁéÃô¶È£¬½«Êı¾İ´óĞ¡À©´óÁË10
             -±¶                 
 130   2             LedOut[0] = D[3]/100%10;
 131   2             LedOut[1] = D[3]/10%10;
 132   2             LedOut[2] = D[3]/1%10;
 133   2                 LedOut[3] = D[3]*10%10;      
 134   2      
 135   2                      //³µ¿â²¹¹âÄ£¿é
 136   2                      //Çé¿ö1£º
 137   2                      //µ±³µ¿âÁÁ¶ÈĞ¡ÓÚµÈÓÚ1290ÀÕ¿ËË¹,Èı¸öĞ¡µÆ¾ù²»ÁÁ
 138   2                      if(D[3]*10<=1290)
 139   2                      {
 140   3                              l2=1;
 141   3                              l3=1;
 142   3                              l4=1;
 143   3                      }
 144   2      
 145   2                      //Çé¿ö2£º
 146   2                      //µ±³µ¿âÁÁ¶È´óÓÚµÈÓÚ1300ÀÕ¿ËË¹£¬Ğ¡ÓÚ1310ÀÕ¿ËË¹Ê±£¬Ğ¡µÆP22ÁÁµÆ
 147   2                      else if((D[3]*10>=1300)&&(D[3]*10<1310))
 148   2                      {
 149   3                              l2=0;
 150   3                              l3=1;
 151   3                              l4=1;
 152   3                      }
 153   2      
 154   2                      //Çé¿ö3£º
 155   2                      //µ±³µ¿âÁÁ¶È´óÓÚµÈÓÚ1310ÀÕ¿ËË¹£¬Ğ¡ÓÚ1320ÀÕ¿ËË¹Ê±£¬Ğ¡µÆP22ÁÁµÆ,Ğ¡µÆP23ÁÁµÆ
 156   2                      else if((D[3]*10>=1310)&&(D[3]*10<1320))
 157   2                      {
 158   3                          l2=0;
 159   3                              l3=0;
 160   3                              l4=1;
 161   3                      }
 162   2      
 163   2                      //Çé¿ö4£º
 164   2                      //µ±³µ¿âÁÁÈ´óÓÚµÈÓÚ1320ÀÕ¿ËË¹Ê±£¬Ğ¡µÆP22ÁÁµÆ,Ğ¡µÆP23ÁÁµÆ,Ğ¡µÆP24ÁÁµÆ
 165   2                      else if(D[3]*10>=1320)
 166   2                      {
 167   3                              l2=0;
 168   3                              l3=0;
 169   3                              l4=0;
 170   3                      }
 171   2                 
 172   2      
 173   2                  
 174   2                 /********ÒÔÏÂ½«ADµÄÖµÍ¨¹ı´®¿Ú·¢ËÍ³öÈ¥*************/
 175   2                 
 176   2                 if(flag==1)        //·¢ËÍÊı¾İÌõ¼ş£¬¿ª¹ØÔÚ´®¿ÚÖĞ¶Ïº¯ÊıÖĞ£¬µ±½ÓÊÕÍêPC¶ËĞÅÏ¢ºó×Ô¶¯´¥·¢
C51 COMPILER V9.00   MAIN                                                                  06/25/2021 08:32:10 PAGE 4   

 177   2           {
 178   3                      //ES=0;  //¹Ø±Õ´®¿ÚÖĞ¶Ï£¬ÏÈ½«ĞèÒª·¢ËÍ¸øPC¶ËµÄ¹âÕÕÇ¿¶ÈÊı¾İ£¬°´Î»·¢ËÍ¸øPC¶ËÖ±µ½È«²¿·¢ËÍÍê±Ï
 179   3               for(i=0;i<4;i++)
 180   3                       {
 181   4               SBUF=LedOut[i];//´æÒ»Ìõ·¢Ò»Ìõ£¬Ö±µ½·¢ÍêÎªÖ¹
 182   4               while(!TI);
 183   4               TI=0;              //Èí¼şÇå0£¬È»ºóÑ­»·ÏÂÒ»´Î×Ö·û
 184   4                       }
 185   3      
 186   3                      ES=1; //¿ªÆô´®¿ÚÖĞ¶ÏµÈ´ıÏÂÒ»´ÎµÄPC¶ËÊı¾İ·¢ËÍ£¨Ò²¾ÍÊÇµ¥Æ¬»úµÈ´ı½ÓÊÕ£©
 187   3                  
 188   3               }
 189   2                              
 190   2                      
 191   2                      display(); // ÔÚLCDÏÔÊ¾ÆÁÉÏÏÔÊ¾¹âÕÕÇ¿¶È£¨µÚÒ»ĞĞ£©ºÍµ¹³µ¾àÀë£¨µÚ¶şĞĞ£©
 192   2              }
 193   1      }
 194          
 195          /*==============================================
 196          £¡£¡£¡£¡£¡ÒÔÏÂÎªHC-SR04³¬Éù²¨Ä£¿éµÄÉèÖÃ£º£¡£¡£¡£¡
 197          ===============================================*/
 198          /*Æô¶¯³¬Éù²¨²â¾à*/
 199          void startUltra(){ // ²úÉúÒ»¸ö´óÓÚ10usµÄ¸ßµçÆ½£¬HC-SR04³¬Éù²¨Ä£¿éµÄÆô¶¯Ìõ¼ş£¡
 200   1              trig = 1;
 201   1              delayUs(15);
 202   1              trig = 0;
 203   1      }
 204          
 205          /*¶¨Ê±Æ÷0ºÍ1³õÊ¼»¯º¯Êı*/
 206          void timerInit(){
 207   1              TMOD = 0x21; // ¶¨Ê±Æ÷1 ¶¨Ê±Ä£Ê½ ¹¤×÷·½Ê½2 8Î»×Ô¶¯ÖØ×°ÔØ
 208   1                                      // ¶¨Ê±Æ÷0 ¶¨Ê±Ä£Ê½ ¹¤×÷·½Ê½1 ·ÇÃÅ¿ØÆô¶¯
 209   1              TH0 = 0x00; //ÉèÖÃ¶¨Ê±Ê±¼ä
 210   1              TL0 = 0x00;     //ÉèÖÃ¶¨Ê±Ê±¼ä
 211   1              TL1=0XFa;  //³õÖµÎª250£¬²¨ÌØÂÊÎª£º4800
 212   1          TH1=0XFa;  //³õÖµÎª250£¬²¨ÌØÂÊÎª£º4800
 213   1              TR1=1;  //Æô¶¯¶¨Ê±Æ÷T1£¡
 214   1              SM0=0;     //Éè¶¨´®¿Ú¹¤×÷·½Ê½
 215   1          SM1=1;     //·½Ê½1£¬SM0=0£¬SM1=1
 216   1          REN=1;     //×¼Ğí´®¿Ú½ÓÊÕ£¬ÏÖÔÚÏÈÉè¶¨ÎªÖ»·¢ËÍĞÅÏ¢µ½PC¶Ë
 217   1              ET0 = 1; // ¿ªtimer0Òç³öÖĞ¶Ï
 218   1              EA = 1; // ¿ªÈ«¾ÖÖĞ¶Ï
 219   1          ES=1;   //¿ª´®¿ÚÖĞ¶Ï
 220   1              
 221   1      }
 222          
 223          /*Ô­¶¨ÓÃ£º¶¨Ê±Æ÷1½øĞĞ¼ÆÊ±ÈÃµ¥Æ¬»úÃ¿1sÖÓ²âÊÔÒ»´Î¾àÀëºÍ¹âÕÕÇ¿¶È£¬
 224          ÔÚ¶¨Ê±Æ÷1µÄÖĞ¶Ïº¯ÊıÖĞÍ¬Ê±°ì²â¾àºÍ²â¹âÇ¿Á½¼şÊÂ£¡£¡*/
 225          /*
 226          void timer1Service() interrupt 3  //¶¨Ê±Æ÷T1  3.5
 227          {
 228                  TH1=(65536-50000)/256; //ÉèÖÃ¶¨Ê±Ê±¼ä
 229                  TL1=(65536-50000)%256; //ÉèÖÃ¶¨Ê±Ê±¼ä   
 230                  nn++;
 231                  if(nn==20)//20*20ms=1sÖÓ¼ÆÊ±Ò»´Î£¬ÈÃ¶¨Ê±Æ÷½øÈëÁ½¸ö²âÁ¿²¿·Ö£»
 232                  {
 233          
 234                          //³¬Éù²¨²â¾àÀë²¿·Ö£º
 235                          echo = 0; // ½ÓÊÕ»ØÒô¶ËÖÃ0
 236                          startUltra(); // Æô¶¯³¬Éù²â¾à
 237                          while(!echo); // µÈ´ı»ØÒô
 238                          TR0 = 1; // ¿ªÊ¼¼ÆÊ±
C51 COMPILER V9.00   MAIN                                                                  06/25/2021 08:32:10 PAGE 5   

 239                          while(echo);
 240                          TR0 = 0; // Í£Ö¹¼ÆÊ±
 241                          computeDis(); // ¼ÆËã¾àÀë
 242                          display(distance); // ÏÔÊ¾¾àÀë£¨µ¥Î»mmºÁÃ×£©
 243          
 244                          //¹âÃôµç×è²â¹âÕÕÇ¿¶È²¿·Ö£º
 245                          //µÈ´ıÒ»ÊÖ²Ë¹·Ìï½¨°î£¡
 246          
 247                          //¶Ô¶¨Ê±Æ÷1s½øĞĞÇåÁã
 248                          nn=0;   
 249                  }
 250          }
 251          */
 252          
 253          
 254          /*½ÓÊÕPC¶ËÊı¾İÄ£¿é£¬´®¿ÚÖĞ¶Ï£¬ÔÚÕâÀïÊÇÓÃÀ´½ÓÊÕPC¶ËµÄÒ»¸ö¾àÀëĞÅÏ¢£¨16½øÖÆ£©£¬
 255          ½«Õâ¸ö¾àÀëĞÅÏ¢×ª»»Îª10½øÖÆµÄÎ£ÏÕ¾àÀë£¬Í¨¹ıPC¶Ë¿ØÖÆµ¥Æ¬»ú£¬
 256          ½ÓÊÕµ½Ôò´ò¿ªmainº¯ÊıÖĞµÄ·¢ËÍÊı¾İÄ£¿é*/
 257          
 258          void ser() interrupt 4    //µ±½ÓÊÕµ½PC·¢ËÍµÄÊı¾İÊ±£¬×Ô¶¯½øÈëÖĞ¶Ï³ÌĞò
 259          {
 260   1        unsigned int shi,ge;//´æ·Å½ÓÊÕ¹ıÀ´µÄÎ£ÏÕ¾àÀëÖµµÄÊ®Î»ºÍ¸öÎ»£¬ÔÚÕâÀï½«16½øÖÆ×ª»¯³É10½øÖÆ
 261   1                                 //PC¶Ë·¢ËÍµ¹³µµÄÎ£ÏÕ¾àÀëµ¥Î»cm
 262   1        jieshou=SBUF;//½«½ÓÊÕµ½µÄÊı¾İ´æµ½aÖĞ,ÕâÀïÒªÇóPC¶Ë·¢ËÍÒ»¸ö0£¬Ò²¾ÍÊÇµÍµçÆ½£¬µ±PC¶Ë·¢ËÍ0Ê±Ôòµ¥Æ¬»ú·äÃùÆ÷Ïì1
             -sÖÓ´ú±í½ÓÊÕµ½PC¶ËÈ·ÈÏĞÅÏ¢
 263   1        shi=jieshou/16;//È¡³ö´ÓPC¶Ë´«¹ıÀ´µÄ16½øÖÆÊıµÄÊ®Î»
 264   1        ge=jieshou%16; //È¡³ö´ÓPC¶Ë´«¹ıÀ´µÄ16½øÖÆÊıµÄ¸öÎ»
 265   1        weixian=(shi*10+ge)*100;//½«16½øÖÆÊ®¸öÎ»Ïà¼Ó×ª»¯³É10½øÖÆ£¬ÒòÎªÔÚPC¶ËÊÇdmÔÚµ¥Æ¬»úÖĞÊÇmmËùÒÔ£¬ĞèÒª*100½øĞĞ
             -µ¥Î»×ª»»,¿ÉÒÔµ÷½Ú·¶Î§0~1600mm
 266   1        fm=0;
 267   1        delay(1000);//·äÃùÆ÷ÏìÒ»ÃëÖÓ£¬±íÊ¾½ÓÊÕµ½ÁËPC¶ËĞÅÏ¢
 268   1        fm=1;
 269   1        flag=1;  //flagÊÇmainº¯ÊıÖĞ£¬µ¥Æ¬»ú·¢ËÍÊı¾İµÄÌõ¼ş
 270   1        RI=0;    //½«R1Çå0µÈ´ıÏÂÒ»´Î½ÓÊÕÊı¾İ
 271   1        //ES=0;    //½ÓÊÕµ½Ò»´Îpc¶ËµÄÇëÇó·¢ËÍLCDĞÅÏ¢ºó£¬Ôò¹Ø±Õ´®¿ÚÖĞ¶Ï£¬Ö±½Ó½«LCDÏÔÊ¾µÄ²âµÃÊı¾İ·¢ËÍ¸øPC¶Ë
 272   1        REN=0;
 273   1          
 274   1      }
 275          
 276          
 277          /*¶¨Ê±Æ÷0Òç³öÖĞ¶Ï·şÎñ³ÌĞò*/
 278          void timer0Service() interrupt 1{ // ¼ÆÊıÒç³öËµÃ÷³¬³ö²â¾à·¶Î§
 279   1              echo = 0; // Ç¿ÖÆ¹Ø±Õ»ØÒô
 280   1      }
 281          
 282          /*ÑÓÊ±x * 1 us*/
 283          void delayUs(uint xus){
 284   1              uint i;
 285   1              for(i = xus; i > 0; i--){
 286   2                      _nop_();                        //¿Õº¯Êı_nop()_£¬Ïàµ±ÓÚÒ»¸ö¶ÌÔİÑÓÊ±£º1us
 287   2              }
 288   1      }
 289          
 290          /*¼ÆËã¾àÀë*/
 291          void computeDis(){
 292   1              time = TH0 * 256 + TL0;    //Ê±¼ä×ª»»Îªtime
 293   1              distance = FACTOR * time;  //FACTORºê¶¨Òå¹ıÎª£º0.1845
 294   1              TH0 = 0x00; // ÖØ×°³õÖµ
 295   1              TL0 = 0x00;
 296   1      }
 297          
 298          /*==============================================
C51 COMPILER V9.00   MAIN                                                                  06/25/2021 08:32:10 PAGE 6   

 299          £¡£¡£¡£¡£¡£¡ÒÔÏÂÎªLCD1602µÄÏÔÊ¾ÉèÖÃ£º£¡£¡£¡£¡£¡£¡
 300          ===============================================*/
 301          
 302          /*³õÊ¼»¯LCD1602µÄÉèÖÃ*/
 303          void LCDInit(){
 304   1              uchar i;
 305   1              lcden = 0; // À­µÍÊ¹ÄÜ¶Ë£¬×¼±¸²úÉúÊ¹ÄÜ¸ßÂö³åĞÅºÅ
 306   1              writeCommand(0x38); // ÏÔÊ¾Ä£Ê½ÉèÖÃ(16x2£¬ 5x7µãÕó£¬8Î»Êı¾İ½Ó¿Ú)
 307   1              writeCommand(0x0c); // ¿ªÏÔÊ¾£¬²»ÏÔÊ¾¹â±ê
 308   1              writeCommand(0x06); // Ğ´Ò»¸ö×Ö·ûºóµØÖ·Ö¸Õë×Ô¶¯¼Ó1
 309   1              writeCommand(0x01); // ÏÔÊ¾ÇåÁã£¬Êı¾İÖ¸ÕëÇåÁã
 310   1              
 311   1              /*LCDÉÏµç½çÃæ*/  
 312   1      
 313   1              //µÚÒ»ĞĞµÄÉèÖÃ£ºÓÃÀ´ÏÔÊ¾¹âÕÕÇ¿¶È¿ØÖÆ¿ª¹ØµÆ
 314   1              writeCommand(0x80); // ½«Êı¾İÖ¸Õë¶¨Î»µ½µÚÒ»ĞĞÊ×
 315   1              for(i = 0; i < strlen(table0); i++){
 316   2                      writeDataLCD(table0[i]);
 317   2                      delay(5);
 318   2              }         
 319   1              
 320   1              
 321   1              //µÚ¶şĞĞµÄÉèÖÃ£ºÓÃÀ´ÏÔÊ¾¹âÕÕÇ¿¶È¿ØÖÆĞ¡³µ
 322   1              writeCommand(0x80 + 0x40); // ½«Êı¾İÖ¸Õë¶¨Î»µ½µÚ¶şĞĞÊ×
 323   1              for(i = 0; i < strlen(table1); i++){
 324   2                      writeDataLCD(table1[i]);  //±ê×¢ĞÅÏ¢:Distance
 325   2                      delay(5);
 326   2              }
 327   1      }
 328          
 329          /*LCDÏÔÊ¾º¯Êı*/
 330          void display(){
 331   1              /*¹âÃô²â¹âÇ¿²¿·ÖµÚÒ»ĞĞÏÔÊ¾*/    
 332   1              uchar  i;               
 333   1              for(i = 0; i < 4; i++){
 334   2                      writeCommand(0x80 + 0x00 + strlen(table0) + i);
 335   2                      writeDataLCD(table2[LedOut[i]]);//¹âÕÕÇ¿¶È
 336   2                      delay(5);
 337   2              }
 338   1              for(i = 0; i < strlen(table4); i++){
 339   2                      writeCommand(0x80 + 0x00 + strlen(table0) + 4 + i);
 340   2                      writeDataLCD(table4[i]);    //µ¥Î»£ºLux
 341   2                      delay(5);
 342   2              }
 343   1      
 344   1      
 345   1              /*³¬Éù²¨²â¾à²¿·ÖµÚ¶şĞĞÏÔÊ¾*/
 346   1                      
 347   1              for(i = 0; i < 4; i++){
 348   2                      writeCommand(0x80 + 0x40 + strlen(table1) + i);
 349   2                      writeDataLCD(table2[dis[i]]);//¾àÀë
 350   2                      delay(5);
 351   2              }
 352   1              for(i = 0; i < strlen(table3); i++){
 353   2                      writeCommand(0x80 + 0x40 + strlen(table1) + 4 + i);
 354   2                      writeDataLCD(table3[i]);    //µ¥Î»£ºmm
 355   2                      delay(5);
 356   2              }
 357   1      
 358   1      }
 359          
 360          /*Ğ´Ö¸Áîº¯Êı*/
C51 COMPILER V9.00   MAIN                                                                  06/25/2021 08:32:10 PAGE 7   

 361          void writeCommand(uchar command){
 362   1              lcdrs = 0; // ÃüÁîÑ¡Ôñ
 363   1              lcdrw = 0;
 364   1              P0 = command;
 365   1              delay(5);
 366   1              
 367   1              lcden = 1; // ²úÉúÒ»¸öÕıÂö³åÊ¹ÄÜĞÅºÅ
 368   1              delay(5);
 369   1              lcden = 0;
 370   1      }
 371          
 372          /*Ğ´Êı¾İº¯Êı*/
 373          void writeDataLCD(uchar dat){
 374   1              lcdrs = 1; // Êı¾İÑ¡Ôñ
 375   1              lcdrw = 0;
 376   1              P0 = dat;
 377   1              delay(5);
 378   1              
 379   1              lcden = 1;
 380   1              delay(5);
 381   1              lcden = 0;
 382   1      }
 383          
 384          /*ÑÓÊ±x* 1 msº¯Êı*/
 385          void delay(uint xms){
 386   1              uint i, j;
 387   1              for(i = xms; i > 0; i--)
 388   1                      for(j = 125; j > 0; j--);
 389   1      }
 390          
 391          /*¹âÃôÄ£¿éad×ª»»£º*/
 392          /*******************************************************************
 393          DAC ±ä»», ×ª»¯º¯Êı               
 394          *******************************************************************/
 395          bit DACconversion(unsigned char sla,unsigned char c,  unsigned char Val)
 396          {
 397   1         Start_I2c();              //Æô¶¯×ÜÏß
 398   1         SendByte(sla);            //·¢ËÍÆ÷¼şµØÖ·
 399   1         if(ack==0)return(0);
 400   1         SendByte(c);              //·¢ËÍ¿ØÖÆ×Ö½Ú
 401   1         if(ack==0)return(0);
 402   1         SendByte(Val);            //·¢ËÍDACµÄÊıÖµ  
 403   1         if(ack==0)return(0);
 404   1         Stop_I2c();               //½áÊø×ÜÏß
 405   1         return(1);
 406   1      }
 407          
 408          /*******************************************************************
 409          ADC·¢ËÍ×Ö½Ú[ÃüÁî]Êı¾İº¯Êı               
 410          *******************************************************************/
 411          bit ISendByte(unsigned char sla,unsigned char c)
 412          {
 413   1         Start_I2c();              //Æô¶¯×ÜÏß
 414   1         SendByte(sla);            //·¢ËÍÆ÷¼şµØÖ·
 415   1         if(ack==0)return(0);
 416   1         SendByte(c);              //·¢ËÍÊı¾İ
 417   1         if(ack==0)return(0);
 418   1         Stop_I2c();               //½áÊø×ÜÏß
 419   1         return(1);
 420   1      }
 421          
 422          /*******************************************************************
C51 COMPILER V9.00   MAIN                                                                  06/25/2021 08:32:10 PAGE 8   

 423          ADC¶Á×Ö½ÚÊı¾İº¯Êı               
 424          *******************************************************************/
 425          unsigned char IRcvByte(unsigned char sla)
 426          {  unsigned char c;
 427   1      
 428   1         Start_I2c();          //Æô¶¯×ÜÏß
 429   1         SendByte(sla+1);      //·¢ËÍÆ÷¼şµØÖ·
 430   1         if(ack==0)return(0);
 431   1         c=RcvByte();          //¶ÁÈ¡Êı¾İ0
 432   1      
 433   1         Ack_I2c(1);           //·¢ËÍ·Ç¾Í´ğÎ»
 434   1         Stop_I2c();           //½áÊø×ÜÏß
 435   1         return(c);
 436   1      }
 437          
 438          
 439          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1338    ----
   CONSTANT SIZE    =     32    ----
   XDATA SIZE       =     16    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     85      13
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
